jQuery(document).ready(function(e){"use strict";function t(t){t.preventDefault();var i=e(this),a=i.closest(".detheme-field-image"),r=e(".add_detheme_image",a),d=r.find("img").data("id"),m=a.find("input").val();m=""==m?new Array:m.split(/,/);for(var l=0;l<m.length;l++)m[l]==d&&m.splice(l,1);r.html(r.attr("title")),a.find("input").val("").trigger("change"),i.hide()}wp.media.DethemeImageEdit={getData:function(){return this.formfield.val()},set:function(t){var i=t.attributes.mime;if(/video/.test(i)){var a=e('<video autoplay data-id="'+t.get("id")+'" width="266"/>'),r=e("<source/>"),d=t.attributes.thumb.src;r.attr("src",t.attributes.url),r.attr("type",i),a.attr("poster",d),a.append(r)}else var a=e('<img data-id="'+t.get("id")+'" width="266" src="'+t.attributes.url+'"/>');return this.preview.find("a").html(a),this.formfield.val(t.get("id")).trigger("change"),this.field.find(".remove_detheme_image").show(),!1},frame:function(i){var a=i.find(".add_detheme_image"),r=i.find(".remove_detheme_image"),d=(i.find("input"),i.find(".preview-image")),m=a.data("type")?a.data("type"):"image",l=a.data("insert-label")?a.data("insert-label"):"Insert Image",n=a.data("select-label")?a.data("select-label"):"Select Image";return d.length||(d=e("<p></p>").addClass("preview-image"),i.prepend(d)),this.field=i,this.formfield=i.find("input"),this.preview=d,r.click(t),this._frame?this._frame:(this._frame=wp.media({id:"detheme_image",state:"insert-image",title:l,editing:!0,multiple:!1,toolbar:"insert-image",menu:"insert-image",type:"image",states:[new wp.media.controller.DethemeImageEdit({library:wp.media.query({type:m}),title:n})]}),this._frame.on("toolbar:create:insert-image",function(e){this.createSelectToolbar(e,{text:n})},this._frame),this._frame.state("insert-image").on("select",this.select),this._frame)},select:function(){var e=this.get("selection").single();wp.media.DethemeImageEdit.set(e?e:-1)}},wp.media.controller.DethemeImageEdit=wp.media.controller.FeaturedImage.extend({defaults:_.defaults({id:"insert-image",filterable:"uploaded",multiple:!1,toolbar:"insert-image",library:wp.media.query({type:"image"}),title:"Select Image",priority:60,syncSelection:!1},wp.media.controller.Library.prototype.defaults),updateSelection:function(){var e,t=this.get("selection"),i=wp.media.DethemeImageEdit.getData();""!==i&&-1!==i&&(e=wp.media.model.Attachment.get(i),e.fetch()),t.reset(e?[e]:[])}}),e(".detheme-field-image").length&&e(".detheme-field-image").each(function(){var i=e(this);i.find(".add_detheme_image").unbind("click").click(function(){wp.media.DethemeImageEdit.frame(i).open()}),i.find(".remove_detheme_image").unbind("click").click(t)})});