jQuery(document).ready(function(e){"use strict";function t(t){t.preventDefault();var i=e(this),a=i.closest(".attach_media_field"),d=e("a.gallery_widget_add_media",a),r=d.find(".media-preview img").data("id"),n=a.find("input").val();n=""==n?new Array:n.split(/,/);for(var l=0;l<n.length;l++)n[l]==r&&n.splice(l,1);d.html(d.attr("title")),a.find("input").val("").trigger("change"),i.hide()}var i=window.dtvc_i18nLocale;wp.media.DethemeMediaEdit={getData:function(){return this.formfield.val()},set:function(t){if(this.getData()==t.get("id"))return!1;var i=e('<div class="media-preview"></div>'),a=e('<img class="'+t.attributes.type+'" src="'+("image"==t.attributes.type?t.attributes.url:t.attributes.icon)+'" data-id="'+t.get("id")+'" />'),d=e('<span class="media-label"></span>');return d.text(t.attributes.filename),i.append(a,d),this.preview.find("a.gallery_widget_add_media").html(i),this.formfield.val(t.get("id")).trigger("change"),this.field.find(".remove_attach_media").show(),!1},frame:function(e){var a=(e.find(".gallery_widget_add_media"),e.find(".remove_attach_media")),d=(e.find("input"),e.find(".gallery_widget_attached_medias_list li")),r=e.data("type");return this.field=e,this.formfield=e.find("input"),this.preview=d,a.click(t),this._frame?this._frame:(this._frame=wp.media({id:"detheme_media",state:"insert-image",title:i.insert_media,editing:!0,multiple:!1,toolbar:"insert-image",menu:"insert-image",type:"image",states:[new wp.media.controller.DethemeMediaEdit({library:wp.media.query({type:r})})]}),this._frame.on("toolbar:create:insert-image",function(e){this.createSelectToolbar(e,{text:i.select_media})},this._frame),this._frame.state("insert-image").on("select",this.select),this._frame)},select:function(){var e=this.get("selection").single();wp.media.DethemeMediaEdit.set(e?e:-1)}},wp.media.controller.DethemeMediaEdit=wp.media.controller.FeaturedImage.extend({defaults:_.defaults({id:"insert-image",filterable:"uploaded",multiple:!1,toolbar:"insert-image",title:i.select_media_to,priority:60,syncSelection:!1},wp.media.controller.Library.prototype.defaults),updateSelection:function(){var e,t=this.get("selection"),i=wp.media.DethemeMediaEdit.getData();""!==i&&-1!==i&&(e=wp.media.model.Attachment.get(i),e.fetch()),t.reset(e?[e]:[])}}),e(".attach_media_field").length&&e(".attach_media_field").each(function(){var i=e(this);i.find(".gallery_widget_add_media").unbind("click").click(function(){wp.media.DethemeMediaEdit.frame(i).open()}),i.find(".remove_attach_media").unbind("click").click(t)})});